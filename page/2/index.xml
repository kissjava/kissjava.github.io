<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>清风徐来</title>
    <link>https://kissjava.cn/</link>
    <description>Recent content on 清风徐来</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>kissjava.cn</copyright>
    <lastBuildDate>Sat, 27 Jun 2020 09:51:55 +0800</lastBuildDate>
    
        <atom:link href="https://kissjava.cn/index.xml" rel="self" type="application/rss+xml" />
    
    
    
        <item>
        <title>Demo 学 Echo Part14  HTTP Gzip压缩</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part14-http-gzip%E5%8E%8B%E7%BC%A9/</link>
        <pubDate>Sat, 17 Aug 2019 23:05:00 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part14-http-gzip%E5%8E%8B%E7%BC%A9/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part14-http-gzip%E5%8E%8B%E7%BC%A9/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果不采用Echo时，可以使用第三方库&lt;code&gt;gziphandler&lt;/code&gt;，Echo直接用Gzip中间件。
HTTP Gzip 就是耗费一丢丢cpu，但是减少了网络传输的大小，从而提升传输速度也减少了带宽投入。
只要Rquest header中有&lt;code&gt;Accept-Encoding: gzip, deflate&lt;/code&gt;就说明浏览器支持HTTP Gzip，现代浏览器估计没有不支持的。当然后端处理也需要响应头也要插入&lt;code&gt;Content-Encoding: gzip&lt;/code&gt;才行。
么有采用HTTP Gzip看看传输大小：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
    &amp;quot;io&amp;quot;
    &amp;quot;net/http&amp;quot;
    &amp;quot;os&amp;quot;
)

func main() {
    mux := new(http.ServeMux)

    mux.HandleFunc(&amp;quot;/image&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
        f, err := os.Open(&amp;quot;sample.png&amp;quot;)
        if f != nil {
            defer f.Close()
        }
        if err != nil {
            http.Error(w, err.Error(), http.StatusInternalServerError)
            return
        }

        _, err = io.Copy(w, f)
        if err != nil {
            http.Error(w, err.Error(), http.StatusInternalServerError)
        }
    })

    server := new(http.Server)
    server.Addr = &amp;quot;:9000&amp;quot;
    server.Handler = mux

    server.ListenAndServe()
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;效果
&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/735410252.png&#34; alt=&#34;before.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;用上Gzip&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/labstack/echo/middleware&amp;quot;
)

func main() {
	e := echo.New()
	e.Use(middleware.Gzip())

	e.Static(&amp;quot;/assets&amp;quot;, &amp;quot;./assets&amp;quot;)

	e.GET(&amp;quot;/image&amp;quot;, func(c echo.Context) error {
		return c.HTML(http.StatusOK, &amp;quot;&amp;lt;img src=&#39;assets/terminal.png&#39;&amp;gt;&amp;quot;)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;效果：
&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4174351952.png&#34; alt=&#34;after.png&#34;&gt;
图片实际是43K，压缩成了33.9K了。&lt;/p&gt;
- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part14-http-gzip%E5%8E%8B%E7%BC%A9/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part13 跨站点请求伪造（CSRF）</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part13-%E8%B7%A8%E7%AB%99%E7%82%B9%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf/</link>
        <pubDate>Sat, 17 Aug 2019 21:33:00 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part13-%E8%B7%A8%E7%AB%99%E7%82%B9%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part13-%E8%B7%A8%E7%AB%99%E7%82%B9%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;跨站点请求伪造（CSRF）攻击以及如何预测它们&lt;/p&gt;
&lt;p&gt;此类攻击的示例：尝试通过Web浏览器以外的媒体登录，例如使用CURL等&lt;/p&gt;
&lt;p&gt;通常的防御方法是使用csrf令牌。在有表单的每个页面上，都会生成csrf令牌。提交表单时，会在请求中插入CSRF，然后后端检查发送的CSRF是否有效&lt;/p&gt;
&lt;p&gt;csrf令牌本身是每次表单页面出现时生成的随机字符串。通常在每个POST请求中，令牌都作为标头，数据表单或查询字符串插入&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;html/template&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/labstack/echo/middleware&amp;quot;
)

type M map[string]interface{}

func main() {
	tmpl := template.Must(template.ParseGlob(&amp;quot;./*.html&amp;quot;))

	e := echo.New()

	const CSRF_TOKEN_HEADER = &amp;quot;X-Csrf-Token&amp;quot;
	const CSRF_KEY = &amp;quot;csrf_token&amp;quot;

	e.Use(middleware.CSRFWithConfig(middleware.CSRFConfig{
		TokenLookup: &amp;quot;header:&amp;quot; + CSRF_TOKEN_HEADER,
		ContextKey:  CSRF_KEY,
	}))

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) error {
		data := make(M)
		data[CSRF_KEY] = c.Get(CSRF_KEY)
		return tmpl.ExecuteTemplate(c.Response(), &amp;quot;view.html&amp;quot;, data)
	})

	//sayhello处理程序中没有csrf标记检查，因为它已被中间件隐式处理
	e.POST(&amp;quot;/sayhello&amp;quot;, func(c echo.Context) error {
		data := make(M)
		if err := c.Bind(&amp;amp;data); err != nil {
			return err
		}

		message := fmt.Sprintf(&amp;quot;hello %s&amp;quot;, data[&amp;quot;name&amp;quot;])
		return c.JSON(http.StatusOK, message)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;view.html&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;form id=&amp;quot;form&amp;quot; action=&amp;quot;/sayhello&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;
        &amp;lt;div&amp;gt;
            &amp;lt;label&amp;gt;Name&amp;lt;/label&amp;gt;
            &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;name&amp;quot; placeholder=&amp;quot;Type your name here&amp;quot;&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div&amp;gt;
            &amp;lt;label&amp;gt;Gender&amp;lt;/label&amp;gt;
            &amp;lt;select name=&amp;quot;gender&amp;quot;&amp;gt;
                &amp;lt;option value=&amp;quot;&amp;quot;&amp;gt;Select one&amp;lt;/option&amp;gt;
                &amp;lt;option value=&amp;quot;male&amp;quot;&amp;gt;Male&amp;lt;/option&amp;gt;
                &amp;lt;option value=&amp;quot;female&amp;quot;&amp;gt;Female&amp;lt;/option&amp;gt;
            &amp;lt;/select&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div&amp;gt;
            &amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;csrf_token&amp;quot; value=&amp;quot;{{ .csrf_token }}&amp;quot;&amp;gt;
            &amp;lt;button type=&amp;quot;submit&amp;quot;&amp;gt;Submit&amp;lt;/button&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/form&amp;gt;

    &amp;lt;script src=&amp;quot;https://code.jquery.com/jquery-3.3.1.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;

    &amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
        $(function () {
            $(&#39;form&#39;).on(&#39;submit&#39;, function (e) {
                e.preventDefault()
        
                var self = $(this)
        
                var formData = {
                    name: self.find(&#39;[name=&amp;quot;name&amp;quot;]&#39;).val(),
                    gender: self.find(&#39;[name=&amp;quot;gender&amp;quot;]&#39;).val(),
                }
        
                var url = self.attr(&#39;action&#39;)
                var method = self.attr(&#39;method&#39;)
                var payload = JSON.stringify(formData)
        
                $.ajax({
                    url: url,
                    type: method,
                    contentType: &#39;application/json&#39;,
                    data: payload,
                    beforeSend: function(req) {
                        var csrfToken = self.find(&#39;[name=csrf_token]&#39;).val()
                        req.setRequestHeader(&amp;quot;X-Csrf-Token&amp;quot;, csrfToken)
                    },
                }).then(function (res) {
                    alert(res)
                }).catch(function (err) {
                    alert(&#39;ERROR: &#39; + err.responseText)
                    console.log(&#39;err&#39;, err)
                })
            })
        })
    &amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;浏览器访问，提交数据，一切正常：
&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/1911725900.png&#34; alt=&#34;csrf.png&#34;&gt;
如果把JavaScript中的以下去掉，会验证不过的&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;beforeSend: function(req) {
                        var csrfToken = self.find(&#39;[name=csrf_token]&#39;).val()
                        req.setRequestHeader(&amp;quot;X-Csrf-Token&amp;quot;, csrfToken)
                    },
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;尝试直接CURL访问，验证肯定不过&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -X POST http://localhost:9000/sayhello \
     -H &#39;Content-Type: application/json&#39; \
     -d &#39;{&amp;quot;name&amp;quot;:&amp;quot;noval&amp;quot;,&amp;quot;gender&amp;quot;:&amp;quot;male&amp;quot;}&#39;
{&amp;quot;message&amp;quot;:&amp;quot;invalid csrf token&amp;quot;}

curl -X POST http://localhost:9000/sayhello \
     -d &#39;name=Joe&#39; \
     -d &#39;gender=male&#39;
{&amp;quot;message&amp;quot;:&amp;quot;invalid csrf token&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part13-%E8%B7%A8%E7%AB%99%E7%82%B9%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part12 CORS 跨域资源共享和Request 预检</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part12-cors-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8Crequest-%E9%A2%84%E6%A3%80/</link>
        <pubDate>Sat, 17 Aug 2019 20:39:00 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part12-cors-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8Crequest-%E9%A2%84%E6%A3%80/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part12-cors-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8Crequest-%E9%A2%84%E6%A3%80/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;CORS机制，它使用额外的 HTTP 头来告诉浏览器  让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器不同的域、协议或端口请求一个资源时，资源会发起一个跨域 HTTP 请求。
以下是可用于CORS配置的标头列表&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Access-Control-Allow-Origin
Access-Control-Allow-Methods
Access-Control-Allow-Headers
Access-Control-Allow-Credentials
Access-Control-Max-Age
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;CORS配置位于目标Web应用程序的服务器端。
例如：我们的应用程序在本地从google.com中提取数据，然后CORS配置位于google.com;如果我们收到CORS错误，则无法完成任何其他操作，因为CORS应用程序目标由google.com上的人员控制。&lt;/p&gt;
&lt;p&gt;练习时间：
创建一个新项目。这个简单的应用程序将在&lt;code&gt;http//localhost:9000/&lt;/code&gt;上运行，然后我们将尝试从其他域访问它.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
    &amp;quot;log&amp;quot;
    &amp;quot;net/http&amp;quot;
)

func main() {
    http.HandleFunc(&amp;quot;/index&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set(&amp;quot;Access-Control-Allow-Origin&amp;quot;, &amp;quot;https://www.google.com&amp;quot;)
        w.Header().Set(&amp;quot;Access-Control-Allow-Methods&amp;quot;, &amp;quot;OPTIONS, GET, POST, PUT&amp;quot;)
        w.Header().Set(&amp;quot;Access-Control-Allow-Headers&amp;quot;, &amp;quot;Content-Type, X-CSRF-Token&amp;quot;)

        if r.Method == &amp;quot;OPTIONS&amp;quot; {
            w.Write([]byte(&amp;quot;allowed&amp;quot;))
            return
        }

        w.Write([]byte(&amp;quot;hello&amp;quot;))
    })

    log.Println(&amp;quot;Starting app at :9000&amp;quot;)
    http.ListenAndServe(&amp;quot;:9000&amp;quot;, nil)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;上面的代码表示允许从&lt;code&gt;https://www.google.com&lt;/code&gt;发送的请求进入;我们选择了谷歌域名，因为测试将从那里完成，请求的目标是&lt;code&gt;http://localhost:9000/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;我们模拟是从google.com 访问 本地主机Web应用&lt;code&gt;localhost:9000&lt;/code&gt;（使用Chrome的开发人员工具从浏览器执行请求）。不是通过&lt;code&gt;localhost:9000&lt;/code&gt;访问&lt;code&gt;google.com&lt;/code&gt;，不要理解为颠倒。&lt;/p&gt;
&lt;p&gt;再次说明，localhost:9000是受，google.com是攻。够形象了吧。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Access-Control-Allow-Methods&lt;/code&gt;标头确定允许哪些HTTP方法（使用逗号分隔符输入）
&lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt;标头确定请求中允许哪些标头密钥。&lt;/p&gt;
&lt;p&gt;好的，我们可以测试了。
首先，请确保安装了Google Chrome；
其次，你可以爬墙；
然后安装jQuery Injector扩展。
打开&lt;code&gt;https://www.google.com&lt;/code&gt;然后注入jQuery。通过强制注入jQuery然后从谷歌网站我们可以使用jQuery。
打开Chrome开发者工具，切换到Console标签页。输入以下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$.ajax({
    url: &amp;quot;http://localhost:9000/index&amp;quot;,
})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ok,结果如下图
&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/2029474600.png&#34; alt=&#34;cors_from_google_to_localhost.png&#34;&gt;
我切换到hk代理，打开google.com.hk，在执行操作就不能访问。因为&lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;我们只设置了&lt;code&gt;www.google.com&lt;/code&gt;.如果我们需要能访问呢？以下就可以搞定允许多个主机来访问：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http.HandleFunc(&amp;quot;/index&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
    w.Header().Set(&amp;quot;Access-Control-Allow-Origin&amp;quot;, 
        &amp;quot;https://www.google.com, https://www.google.com.hk&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;当然也可以不设防，赤果果&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;w.Header().Set(&amp;quot;Access-Control-Allow-Origin&amp;quot;, &amp;quot;*&amp;quot;)
w.Header().Set(&amp;quot;Access-Control-Allow-Methods&amp;quot;, &amp;quot;*&amp;quot;)
w.Header().Set(&amp;quot;Access-Control-Allow-Headers&amp;quot;, &amp;quot;*&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;##第三方CORS库来稍微优雅点解决问题
&lt;code&gt;$ go get github.com/rs/cors&lt;/code&gt;
利用中间件，代码优雅&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/rs/cors&amp;quot;
)

func main() {
	e := echo.New()

	corsMiddleware := cors.New(cors.Options{
		AllowedOrigins: []string{&amp;quot;https://www.google.com.hk&amp;quot;, &amp;quot;https://www.google.com&amp;quot;},
		AllowedMethods: []string{&amp;quot;OPTIONS&amp;quot;, &amp;quot;GET&amp;quot;, &amp;quot;POST&amp;quot;, &amp;quot;PUT&amp;quot;},
		AllowedHeaders: []string{&amp;quot;Content-Type&amp;quot;, &amp;quot;X-CSRF-Token&amp;quot;},
		Debug:          true,
	})
	e.Use(echo.WrapMiddleware(corsMiddleware.Handler))

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) error {
		return c.String(http.StatusOK, &amp;quot;hello&amp;quot;)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定。&lt;/p&gt;
- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part12-cors-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8Crequest-%E9%A2%84%E6%A3%80/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part11 Gorilla Session</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part11-gorilla-session/</link>
        <pubDate>Sat, 17 Aug 2019 19:57:02 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part11-gorilla-session/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part11-gorilla-session/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;前面用了Gorilla的Cookie，Session也可以用他写的。
首次访问get时，session没有村数据，显示empty result
访问set时，会写入hello 和 world，然后再307临时重定向到get，会显示 hello world
访问delete，会删除session，再307到get显示empty result。&lt;/p&gt;
&lt;p&gt;demo 采用cookie来存储session数据，也支持其他多种方式存储。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/gorilla/sessions&amp;quot;
	&amp;quot;github.com/labstack/echo&amp;quot;
)

const SESSION_ID = &amp;quot;id&amp;quot;

func newCookieStore() *sessions.CookieStore {
	authKey := []byte(&amp;quot;my-auth-key-very-secret&amp;quot;)
	encryptionKey := []byte(&amp;quot;my-encryption-key-very-secret123&amp;quot;)

	store := sessions.NewCookieStore(authKey, encryptionKey)
	store.Options.Path = &amp;quot;/&amp;quot;
	store.Options.MaxAge = 86400 * 7
	store.Options.HttpOnly = true

	return store
}

var store = newCookieStore()

func main() {
	e := echo.New()

	e.GET(&amp;quot;/get&amp;quot;, func(c echo.Context) error {
		session, _ := store.Get(c.Request(), SESSION_ID)

		if len(session.Values) == 0 {
			return c.String(http.StatusOK, &amp;quot;empty result&amp;quot;)
		}

		return c.String(http.StatusOK, fmt.Sprintf(
			&amp;quot;%s %s&amp;quot;,
			session.Values[&amp;quot;message1&amp;quot;],
			session.Values[&amp;quot;message2&amp;quot;],
		))
	})

	e.GET(&amp;quot;/set&amp;quot;, func(c echo.Context) error {
		session, _ := store.Get(c.Request(), SESSION_ID)
		session.Values[&amp;quot;message1&amp;quot;] = &amp;quot;hello&amp;quot;
		session.Values[&amp;quot;message2&amp;quot;] = &amp;quot;world&amp;quot;
		session.Save(c.Request(), c.Response())

		return c.Redirect(http.StatusTemporaryRedirect, &amp;quot;/get&amp;quot;)
	})

	e.GET(&amp;quot;/delete&amp;quot;, func(c echo.Context) error {
		session, _ := store.Get(c.Request(), SESSION_ID)
		session.Options.MaxAge = -1
		session.Save(c.Request(), c.Response())

		return c.Redirect(http.StatusTemporaryRedirect, &amp;quot;/get&amp;quot;)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part11-gorilla-session/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part10 安全的Cookie</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part10-%E5%AE%89%E5%85%A8%E7%9A%84cookie/</link>
        <pubDate>Sat, 17 Aug 2019 19:38:14 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part10-%E5%AE%89%E5%85%A8%E7%9A%84cookie/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part10-%E5%AE%89%E5%85%A8%E7%9A%84cookie/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用securecookie非常简单，通过securecookie.New（）创建一个安全的cookie对象，然后使用该对象进行编码 - 解码cookie数据操作。调用.New（）函数需要2个参数。
第一个，使用HMAC加密算法验证cookie数据需要的哈希密钥
第二个，cookie数据加密需要块密钥，这些密钥是可选的。使用的默认加密算法是AES。&lt;/p&gt;
&lt;p&gt;代码中生成随机字符串是通过使用gubrak的第三方库完成的。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;net/http&amp;quot;
	&amp;quot;time&amp;quot;

	&amp;quot;github.com/gorilla/securecookie&amp;quot;
	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/novalagung/gubrak&amp;quot;
)

type M map[string]interface{}

var sc = securecookie.New([]byte(&amp;quot;very-secret&amp;quot;), []byte(&amp;quot;a-lot-secret-yay&amp;quot;))

func setCookie(c echo.Context, name string, data M) error {
	encoded, err := sc.Encode(name, data)
	if err != nil {
		return err
	}

	cookie := &amp;amp;http.Cookie{
		Name:     name,
		Value:    encoded,
		Path:     &amp;quot;/&amp;quot;,
		Secure:   false,
		HttpOnly: true,
		Expires:  time.Now().Add(1 * time.Hour),
	}
	http.SetCookie(c.Response(), cookie)

	return nil
}

func getCookie(c echo.Context, name string) (M, error) {
	cookie, err := c.Request().Cookie(name)
	if err == nil {

		data := M{}
		if err = sc.Decode(name, cookie.Value, &amp;amp;data); err == nil {
			return data, nil
		}
	}

	return nil, err
}

func main() {
	const COOKIE_NAME = &amp;quot;kissjava_cn_data&amp;quot;

	e := echo.New()

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) error {
		data, err := getCookie(c, COOKIE_NAME)
		if err != nil &amp;amp;&amp;amp; err != http.ErrNoCookie &amp;amp;&amp;amp; err != securecookie.ErrMacInvalid {
			return err
		}

		if data == nil {
			data = M{&amp;quot;Message&amp;quot;: &amp;quot;Hello&amp;quot;, &amp;quot;ID&amp;quot;: gubrak.RandomString(32)}

			err = setCookie(c, COOKIE_NAME, data)
			if err != nil {
				return err
			}
		}

		return c.JSON(http.StatusOK, data)
	})

	e.GET(&amp;quot;/delete&amp;quot;, func(c echo.Context) error {

		cookie := &amp;amp;http.Cookie{}
		cookie.Name = COOKIE_NAME
		cookie.Path = &amp;quot;/&amp;quot;
		cookie.MaxAge = -1
		cookie.Expires = time.Unix(0, 0)
		http.SetCookie(c.Response(), cookie)

		return c.String(http.StatusOK, &amp;quot;Delete Cookie.&amp;quot;)

	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试。&lt;/p&gt;
&lt;p&gt;浏览器访问http://localhost:9000/index
应用会先尝试读取Cookie，如果读取不到&lt;code&gt;data==nil&lt;/code&gt;就会生成一个Cookie；
第二次访问可以读取到，然后解码成对应的数据
可以用chrome的调试工具看到cookie的key为kissjava_cn_data&lt;/p&gt;
&lt;p&gt;访问http://localhost:9000/delete 会删除cookie;完成后调试工具里也就没有cookie了&lt;/p&gt;
- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part10-%E5%AE%89%E5%85%A8%E7%9A%84cookie/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part9 配置文件</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</link>
        <pubDate>Sat, 17 Aug 2019 17:22:53 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;配置文件可以用json，YAML格式
app.conf.json&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{
    &amp;quot;appName&amp;quot;: &amp;quot;SimpleApp&amp;quot;,

    &amp;quot;server&amp;quot;: {
        &amp;quot;port&amp;quot;: 5000
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;main.go&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/spf13/viper&amp;quot;
)

func main() {
	e := echo.New()

	viper.SetConfigType(&amp;quot;json&amp;quot;)
	viper.AddConfigPath(&amp;quot;.&amp;quot;)
	viper.SetConfigName(&amp;quot;app.conf&amp;quot;)

	err := viper.ReadInConfig()
	if err != nil {
		e.Logger.Fatal(err)
	}

	fmt.Println(&amp;quot;Starting&amp;quot;, viper.GetString(&amp;quot;appName&amp;quot;))

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) (err error) {
		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:&amp;quot; + viper.GetString(&amp;quot;server.port&amp;quot;)))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;运行&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;go run main.go
Starting SimpleApp

   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.1.9
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
⇨ http server started on [::]:5000
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用YAML
app.config.yaml&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;appName: SimpleApp2
server:
  port: 9000
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;代码部分修改一下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;viper.SetConfigType(&amp;quot;yaml&amp;quot;)
viper.AddConfigPath(&amp;quot;.&amp;quot;)
viper.SetConfigName(&amp;quot;app.config&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;结果&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;go run main.go
Starting SimpleApp2

   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.1.9
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
⇨ http server started on [::]:9000

&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part8 命令行解析</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part8-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/</link>
        <pubDate>Sat, 17 Aug 2019 16:25:00 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part8-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part8-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;&lt;/p&gt;
&lt;p&gt;启动服务是可以指定app name和port。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;gopkg.in/alecthomas/kingpin.v2&amp;quot;
)

var (
	argAppName = kingpin.Arg(&amp;quot;name&amp;quot;, &amp;quot;Application name&amp;quot;).Required().String()
	argPort    = kingpin.Arg(&amp;quot;port&amp;quot;, &amp;quot;Web server port&amp;quot;).Default(&amp;quot;9000&amp;quot;).Int()
)

func main() {
	kingpin.Parse()

	appName := *argAppName
	port := fmt.Sprintf(&amp;quot;:%d&amp;quot;, *argPort)

	fmt.Printf(&amp;quot;Starting %s at %s&amp;quot;, appName, port)

	e := echo.New()
	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) (err error) {
		return c.JSON(http.StatusOK, true)
	})
	e.Logger.Fatal(e.Start(port))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;编译后执行&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; ./main &amp;quot;Echo Demo part 8&amp;quot; 3000       
Starting Echo Demo part 8 at :3000
   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.1.9
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
⇨ http server started on [::]:3000
&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part8-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part7 Middleware 和 Logging</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part7-middleware-%E5%92%8C-logging/</link>
        <pubDate>Sat, 17 Aug 2019 16:08:04 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part7-middleware-%E5%92%8C-logging/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part7-middleware-%E5%92%8C-logging/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;
中间件是在处理http请求之前或之后调用的代码块。中间件通常按功能来做，例如：身份验证中间件，用于日志记录的中间件，用于gzip压缩的中间件等
跑一遍，来理解&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
)

func middlewareOne(next echo.HandlerFunc) echo.HandlerFunc {
	return func(c echo.Context) error {
		fmt.Println(&amp;quot;from middleware one&amp;quot;)
		return next(c)
	}
}

func middlewareTwo(next echo.HandlerFunc) echo.HandlerFunc {
	return func(c echo.Context) error {
		fmt.Println(&amp;quot;from middleware two&amp;quot;)
		return next(c)
	}
}

func main() {
	e := echo.New()

	// middleware here
	e.Use(middlewareOne)
	e.Use(middlewareTwo)

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) (err error) {
		fmt.Println(&amp;quot;threeeeee!&amp;quot;)

		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;客户端&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl http://localhost:9000/index
output=&amp;gt;true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;服务端输出&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http server started on [::]:9000
from middleware one
from middleware two
threeeeee!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;集成第三方中间件:使用&lt;code&gt;echo.WrapMiddleware（）&lt;/code&gt;函数将中间件转换为echo兼容中间件，前提是必须采用&lt;code&gt;func（http.Handler）http.Handler&lt;/code&gt;的形式来声明中间件。
例如&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
)

func middlewareSomething(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		fmt.Println(&amp;quot;from middleware something&amp;quot;)
		next.ServeHTTP(w, r)
	})
}

func main() {
	e := echo.New()

	// middleware here
	e.Use(echo.WrapMiddleware(middlewareSomething))

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) (err error) {
		fmt.Println(&amp;quot;threeeeee!&amp;quot;)

		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#Client:
curl http://localhost:9000/index
true
#Server:
http server started on [::]:9000
from middleware something
threeeeee!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Echo 自己的 Middleware: Logger&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;github.com/labstack/echo/middleware&amp;quot;
)

func main() {
	e := echo.New()

	e.Use(middleware.LoggerWithConfig(middleware.LoggerConfig{
		Format: &amp;quot;method=${method}, uri=${uri}, status=${status}\n&amp;quot;,
	}))

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) (err error) {
		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;运行一下
服务端按定义出现了一行记录&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#Client:
curl http://localhost:9000/index
true
#Server:
http server started on [::]:9000
method=GET, uri=/index, status=200
&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part7-middleware-%E5%92%8C-logging/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part6 模板渲染</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part6-%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93/</link>
        <pubDate>Sat, 17 Aug 2019 15:17:00 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part6-%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part6-%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;
echo解析和呈现模板的过程不是由自身处理，而是由&lt;code&gt;html/template&lt;/code&gt;包处理。因此，echo中的模板渲染方式与使用普通golang应用程序相同.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;html/template&amp;quot;
	&amp;quot;io&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
)

type M map[string]interface{}

type Info struct {
	Affiliation string
	Address     string
}

func (t Info) GetAffiliationDetailInfo() string {
	return &amp;quot;have 31 divisions&amp;quot;
}

type Person struct {
	Name    string
	Gender  string
	Hobbies []string
	Info    Info
}

//.template属性负责解析和呈现模板
//.location属性指向模板文件所在的文件夹路径。
// debug 如果为false，则模板解析仅在应用程序启动时执行一次。此模式适合在生产阶段激活
type Renderer struct {
	template *template.Template
	debug    bool
	location string
}

//创建NewRenderer（）函数，以便更容易初始化渲染器对象
func NewRenderer(location string, debug bool) *Renderer {
	tpl := new(Renderer)
	tpl.location = location
	tpl.debug = debug

	tpl.ReloadTemplates()

	return tpl
}

//为struct renderer准备两个方法，即ReloadTemplates（）和.Render（）

//ReloadTemplates方法用于解析模板。初始化渲染器对象时必须调用此方法。
//如果.debug == true，则每次访问路径时都必须调用此方法
func (t *Renderer) ReloadTemplates() {
	t.template = template.Must(template.ParseGlob(t.location))
}

func (t *Renderer) Render(
	w io.Writer,
	name string,
	data interface{},
	c echo.Context,
) error {
	if t.debug {
		t.ReloadTemplates()
	}

	return t.template.ExecuteTemplate(w, name, data)
}

func main() {
	e := echo.New()

	e.Renderer = NewRenderer(&amp;quot;./*.html&amp;quot;, true)

	e.GET(&amp;quot;/index&amp;quot;, func(c echo.Context) error {
		data := M{&amp;quot;message&amp;quot;: &amp;quot;Hello World!&amp;quot;}
		return c.Render(http.StatusOK, &amp;quot;index.html&amp;quot;, data)
	})

	e.GET(&amp;quot;/user&amp;quot;, func(c echo.Context) error {
		person := Person{
			Name:    &amp;quot;Bruce&amp;quot;,
			Gender:  &amp;quot;male&amp;quot;,
			Hobbies: []string{&amp;quot;Reading Books&amp;quot;, &amp;quot;Traveling&amp;quot;, &amp;quot;Buying things&amp;quot;},
			Info:    Info{&amp;quot;Julin Enterprises&amp;quot;, &amp;quot;Suzhou City&amp;quot;},
		}
		return c.Render(http.StatusOK, &amp;quot;user.html&amp;quot;, person)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;index.html 如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        Message from index: {{.message}}!
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更复杂的user.html&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;Learning html/template Actions&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;table&amp;gt;
                &amp;lt;tr&amp;gt;
                    {{/* example how to use actions */}}
                    &amp;lt;td&amp;gt;{{&amp;quot;姓名&amp;quot;}}&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: {{.Name}}&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;性别&amp;lt;/td&amp;gt;
                    {{$gender := .Gender}}
                    &amp;lt;td style=&amp;quot;text-transform: capitalize;&amp;quot;&amp;gt;: 
                        {{$gender}}
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;爱好&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: 
                        {{range $index, $elem := .Hobbies}}
                            {{$elem}},
                        {{end}}
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;联系&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: {{.Info.Affiliation}} ({{.Info.GetAffiliationDetailInfo}})&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                {{with .Info}}
                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;Address&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: {{.Address}}&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                {{end}}

                {{if eq .Name &amp;quot;Bruce&amp;quot;}}
                &amp;lt;tr&amp;gt;
                    &amp;lt;td colspan=&amp;quot;2&amp;quot; style=&amp;quot;font-weight: bold;&amp;quot;&amp;gt;
                        Ooooh，Bruce!
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                {{end}}
        &amp;lt;/table&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试一下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl http://localhost:9000/index
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        Message from index: Hello World!!
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;

curl http://localhost:9000/user
&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;Learning html/template Actions&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;table&amp;gt;
                &amp;lt;tr&amp;gt;
                    
                    &amp;lt;td&amp;gt;姓名&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: Bruce&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;性别&amp;lt;/td&amp;gt;
                    
                    &amp;lt;td style=&amp;quot;text-transform: capitalize;&amp;quot;&amp;gt;: 
                        male
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;爱好&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: 
                        
                            Reading Books,
                        
                            Traveling,
                        
                            Buying things,
                        
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;

                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;联系&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: Julin Enterprises (have 31 divisions)&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                
                &amp;lt;tr&amp;gt;
                    &amp;lt;td&amp;gt;Address&amp;lt;/td&amp;gt;
                    &amp;lt;td&amp;gt;: Suzhou City&amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                

                
                &amp;lt;tr&amp;gt;
                    &amp;lt;td colspan=&amp;quot;2&amp;quot; style=&amp;quot;font-weight: bold;&amp;quot;&amp;gt;
                        Ooooh，Bruce!
                    &amp;lt;/td&amp;gt;
                &amp;lt;/tr&amp;gt;
                
        &amp;lt;/table&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part6-%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93/ - kissjava.cn</description>
        </item>
    
    
    
        <item>
        <title>Demo 学 Echo Part5 HTTP 错误处理</title>
        <link>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part5-http-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</link>
        <pubDate>Sat, 17 Aug 2019 13:30:39 +0000</pubDate>
        
        <guid>https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part5-http-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</guid>
        <description>清风徐来 https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part5-http-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/ -&lt;p&gt;&lt;img src=&#34;https://kissjava.cn/usr/uploads/2019/08/4294093216.png&#34; alt=&#34;请输入图片描述&#34;&gt;
自定义错误处理程序
覆盖e.HTTPErrorHandler属性&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;gopkg.in/go-playground/validator.v9&amp;quot;
)

type User struct {
	Name  string `json:&amp;quot;name&amp;quot;  validate:&amp;quot;required&amp;quot;`
	Email string `json:&amp;quot;email&amp;quot; validate:&amp;quot;required,email&amp;quot;`
	Age   int    `json:&amp;quot;age&amp;quot;   validate:&amp;quot;gte=0,lte=80&amp;quot;`
}

type CustomValidator struct {
	validator *validator.Validate
}

func (cv *CustomValidator) Validate(i interface{}) error {
	return cv.validator.Struct(i)
}

func main() {
	e := echo.New()

	e.HTTPErrorHandler = func(err error, c echo.Context) {
		report, ok := err.(*echo.HTTPError)
		if !ok {
			report = echo.NewHTTPError(http.StatusInternalServerError, err.Error())
		}

		c.Logger().Error(report)
		c.JSON(report.Code, report)
	}

	e.Validator = &amp;amp;CustomValidator{validator: validator.New()}

	e.POST(&amp;quot;/users&amp;quot;, func(c echo.Context) error {
		u := new(User)
		if err := c.Bind(u); err != nil {
			return err
		}
		if err := c.Validate(u); err != nil {
			return err
		}

		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试一下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -X POST http://localhost:9000/users \
     -d &#39;name=Joe&#39; \
     -d &#39;email=nope@novalagung.com&#39; \
     -d &#39;age=100&#39;
#output =&amp;gt; {&amp;quot;message&amp;quot;:&amp;quot;Key: &#39;User.Age&#39; Error:Field validation for &#39;Age&#39; failed on the &#39;lte&#39; tag&amp;quot;}

#服务端也会显示错误Log（c.Logger().Error()输出)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;还不错，但是错误提醒对用户不友好，改进一下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;gopkg.in/go-playground/validator.v9&amp;quot;
)

type User struct {
	Name  string `json:&amp;quot;name&amp;quot;  validate:&amp;quot;required&amp;quot;`
	Email string `json:&amp;quot;email&amp;quot; validate:&amp;quot;required,email&amp;quot;`
	Age   int    `json:&amp;quot;age&amp;quot;   validate:&amp;quot;gte=0,lte=80&amp;quot;`
}

type CustomValidator struct {
	validator *validator.Validate
}

func (cv *CustomValidator) Validate(i interface{}) error {
	return cv.validator.Struct(i)
}

func main() {
	e := echo.New()

	e.HTTPErrorHandler = func(err error, c echo.Context) {
		report, ok := err.(*echo.HTTPError)
		if !ok {
			report = echo.NewHTTPError(http.StatusInternalServerError, err.Error())
		}

		if castedObject, ok := err.(validator.ValidationErrors); ok {
			for _, err := range castedObject {
				switch err.Tag() {
				case &amp;quot;required&amp;quot;:
					report.Message = fmt.Sprintf(&amp;quot;%s is required&amp;quot;,
						err.Field())
				case &amp;quot;email&amp;quot;:
					report.Message = fmt.Sprintf(&amp;quot;%s is not valid email&amp;quot;,
						err.Field())
				case &amp;quot;gte&amp;quot;:
					report.Message = fmt.Sprintf(&amp;quot;%s value must be greater than %s&amp;quot;,
						err.Field(), err.Param())
				case &amp;quot;lte&amp;quot;:
					report.Message = fmt.Sprintf(&amp;quot;%s value must be lower than %s&amp;quot;,
						err.Field(), err.Param())
				}

				break
			}
		}

		c.Logger().Error(report)
		c.JSON(report.Code, report)
	}

	e.Validator = &amp;amp;CustomValidator{validator: validator.New()}

	e.POST(&amp;quot;/users&amp;quot;, func(c echo.Context) error {
		u := new(User)
		if err := c.Bind(u); err != nil {
			return err
		}
		if err := c.Validate(u); err != nil {
			return err
		}

		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;再来测试一下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -X POST http://localhost:9000/users \
     -d &#39;name=Joe&#39; \
     -d &#39;email=nope@novalagung.com&#39; \
     -d &#39;age=100&#39;
#output =&amp;gt; {&amp;quot;message&amp;quot;:&amp;quot;Age value must be lower than 80&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;自定义错误页面&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package main

import (
	&amp;quot;fmt&amp;quot;
	&amp;quot;net/http&amp;quot;

	&amp;quot;github.com/labstack/echo&amp;quot;
	&amp;quot;gopkg.in/go-playground/validator.v9&amp;quot;
)

type User struct {
	Name  string `json:&amp;quot;name&amp;quot;  validate:&amp;quot;required&amp;quot;`
	Email string `json:&amp;quot;email&amp;quot; validate:&amp;quot;required,email&amp;quot;`
	Age   int    `json:&amp;quot;age&amp;quot;   validate:&amp;quot;gte=0,lte=80&amp;quot;`
}

type CustomValidator struct {
	validator *validator.Validate
}

func (cv *CustomValidator) Validate(i interface{}) error {
	return cv.validator.Struct(i)
}

func main() {
	e := echo.New()

	e.HTTPErrorHandler = func(err error, c echo.Context) {
		report, ok := err.(*echo.HTTPError)
		if !ok {
			report = echo.NewHTTPError(http.StatusInternalServerError, err.Error())
		}

		errPage := fmt.Sprintf(&amp;quot;%d.html&amp;quot;, report.Code)
		if err := c.File(errPage); err != nil {
			c.HTML(report.Code, &amp;quot;Errrrooooorrrrr&amp;quot;)
		}
	}

	e.Validator = &amp;amp;CustomValidator{validator: validator.New()}

	e.POST(&amp;quot;/users&amp;quot;, func(c echo.Context) error {
		u := new(User)
		if err := c.Bind(u); err != nil {
			return err
		}
		if err := c.Validate(u); err != nil {
			return err
		}

		return c.JSON(http.StatusOK, true)
	})

	e.Logger.Fatal(e.Start(&amp;quot;:9000&amp;quot;))
}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这时有对应code.html时会show出来，否则就出&lt;code&gt;Errrrooooorrrrr&lt;/code&gt;&lt;/p&gt;
- https://kissjava.cn/posts/demo-%E5%AD%A6-echo-part5-http-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/ - kissjava.cn</description>
        </item>
    
    
  </channel>
</rss> 